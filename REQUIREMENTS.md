# DESIGN

## 문서 목적
이 문서는 `memo` 프로젝트의 리팩토링 설계 기준과 요구사항을 누적 관리하기 위한 단일 기준 문서다.  
앞으로 전달되는 요구사항은 본 문서의 `요구사항 백로그`에 순서대로 추가한다.

## 프로젝트 컨텍스트
- 원본 프로젝트: `../jwmemo`
- 리팩토링 대상: 현재 저장소 `memo`
- 현재 확인된 원본 기술 스택:
  - 서버: `Express`, `EJS`, `MongoDB/Mongoose`
  - 클라이언트: `React 15`, `Redux 3`, `webpack 4`
  - 실행 스크립트: `npm run start`, `npm run build-dev`, `npm run build`

## 리팩토링 목표
1. 원본 기능의 동등성 확보(회귀 없는 이전).
2. 코드 구조 단순화(관심사 분리, 모듈 경계 명확화).
3. 빌드/테스트/실행 절차의 표준화.
4. 단계별 마이그레이션이 가능한 작업 단위로 분해.

## 요구사항 기록 규칙
- 식별자: `RQ-001` 형식으로 3자리 증가.
- 상태: `초안` | `확정` | `구현중` | `완료` | `보류`.
- 우선순위: `P0`(긴급) ~ `P3`(낮음).
- 각 항목은 아래 템플릿을 따른다.

```md
### RQ-000 제목
- 상태: 초안
- 우선순위: P1
- 설명: 구현/변경 요구사항
- 완료 조건: 검증 가능한 수용 기준(테스트/동작 기준)
- 메모: 결정 배경, 제약, 참고 경로
```

## 요구사항 백로그
### RQ-001 `memo`는 `jwmemo` 리팩토링 프로젝트다
- 상태: 확정
- 우선순위: P0
- 설명: `memo`는 신규 개발이 아닌 `../jwmemo`의 기능/구조 리팩토링을 목적으로 한다.
- 완료 조건: 이후 정의되는 모든 작업 항목이 원본 대비 기능 유지 여부를 기준으로 관리된다.
- 메모: 원본 코드 기준 경로는 `../jwmemo`로 고정한다.

### RQ-002 데이터 저장소를 MongoDB Atlas(클라우드)로 전환
- 상태: 확정
- 우선순위: P0
- 설명: 원본 `jwmemo`의 레거시 설치형 MongoDB 의존을 제거하고, 클라우드 관리형 MongoDB(Atlas)로 이전한다.
- 완료 조건: 애플리케이션이 Atlas 연결 문자열 기반으로 정상 기동되고, 핵심 데이터 읽기/쓰기(CRUD)가 기존과 동일하게 동작한다.
- 메모: 연결 정보는 코드 하드코딩 금지, 환경 변수 기반(`MONGODB_URI`)으로 관리한다.

### RQ-003 프런트엔드 렌더링 계층을 React 구버전에서 Lithent로 전환
- 상태: 확정
- 우선순위: P0
- 설명: `jwmemo`의 `React 15` 기반 UI를 `memo`에서 `Lithent` 기반으로 재구현한다.
- 완료 조건: 기존 주요 화면(예: 목록/상세/작성)의 기능 동등성이 유지되고, React 의존성이 제거된다.
- 메모: 참고 소스는 `../lithent`, 문서 기준 경로는 `../lithent/lithentDocs`를 우선 사용한다.

### RQ-004 에디터를 CodeMirror(+vim 바인딩)에서 Monaco(+monaco-vim)로 교체
- 상태: 확정
- 우선순위: P1
- 설명: 기존 편집기 구현(CodeMirror + vim 플러그인)을 Monaco Editor + `monaco-vim` 조합으로 대체한다.
- 완료 조건: 노트 편집 화면에서 Vim 모드(모달 전환, 기본 이동/편집 키)가 동작하고, 기존 저장 플로우와 연동된다.
- 메모: 대상 확장 저장소는 `https://github.com/brijeshb42/monaco-vim`.

### RQ-005 원본 백업 아카이브(`mongo-all.archive`)를 MongoDB Atlas로 이관
- 상태: 확정
- 우선순위: P0
- 설명: 프로젝트 루트의 원본 DB 백업 파일 `mongo-all.archive`를 사용해 Atlas 클러스터로 데이터 마이그레이션을 수행한다.
- 완료 조건: 백업 데이터 복원 후 주요 컬렉션 문서 수와 핵심 조회/수정 동작이 원본과 동일함을 검증한다.
- 메모: 이관 절차는 `mongorestore --archive=mongo-all.archive` 기반으로 설계하고, 대상 DB/컬렉션 매핑 규칙을 사전 정의한다.

### RQ-006 에디터/프리뷰 스크롤 동기화(3.3)
- 상태: 확정
- 우선순위: P1
- 설명: 편집 버퍼에서 커서가 위치한 라인이 Preview 창의 중앙에 오도록 스크롤을 동기화한다.
- 완료 조건: Cursor 이동 시 Preview가 동일 라인으로 추적되고, Preview 창에서 해당 라인이 중앙(`zz` 동작 기준)에 정렬된다.
- 메모: 목표는 편집 중 현재 문맥을 Preview 중앙에 유지하는 것이다. 구현 전략은 `CursorMoved` 이벤트 감지 → 현재 라인 획득 → `preview_win` 커서 이동 → `normal! zz` 실행 흐름을 따른다.

### RQ-007 Atlas 재마이그레이션 원클릭 스크립트 준비
- 상태: 확정
- 우선순위: P1
- 설명: 실제 서버에서 최신 dump/archive를 가져오면, 기존 Atlas 데이터(`jmemo`)를 통째로 초기화하고 최신 백업으로 처음부터 재복원하는 절차를 한 번에 실행할 수 있어야 한다.
- 완료 조건: 단일 실행 명령으로 `drop -> restore -> 기본 검증` 순서가 수행되고, 개발 중간/배포 직전 반복 실행이 가능하다.
- 메모: 현재는 문서 설계만 반영하고, 실제 스크립트 구현/실행은 추후 진행한다.

## 오픈 이슈
- 현재 상세 기능 목록(화면/엔드포인트/데이터 모델)과 우선순위는 일부만 정의됨.
- Lithent 문서 경로는 사용자 요청의 `../lithentDocs` 대신 실제 확인된 `../lithent/lithentDocs`를 우선 기준으로 사용한다.
- Atlas 마이그레이션은 최신 dump 기준 전체 재복원 전략으로 합의했으며, 실행 스크립트의 실제 구현 시점만 남아 있다.
- `mongo-all.archive` 복원 시 인증/네트워크(IP Allow List), 대상 DB명, 사전/사후 검증 스크립트 정의가 필요하다.
